---
import ImageCarousel from './fancybox';
import { getImage } from 'astro:assets';

const photoModules = import.meta.glob('../data/photos/photo*.webp', { eager: true });

const photoTitles = {
  1: 'Mall road, Manali', 2: 'Manali', 3: 'Manali', 4: 'Hadimba temple, Manali',
  5: 'Manali', 6: 'Manali', 7: 'Manali', 8: 'Manali', 9: 'Manali',
  10: "Humayun's tomb, Delhi", 11: "Humayun's tomb, Delhi", 12: "Humayun's tomb, Delhi", 13: "Humayun's tomb, Delhi",
  14: 'Jama masjid, Delhi', 15: 'Jama masjid, Delhi', 16: 'Red fort, Delhi',
  17: 'Darwaza-i-rauza, Agra', 18: 'Darwaza-i-rauza, Agra',
  19: 'Taj mahal, Agra', 20: 'Taj mahal, Agra', 21: 'Taj mahal, Agra', 22: 'Taj mahal, Agra',
  23: 'Fort kochi, Kerala', 24: 'St. Francis church, Fort kochi, Kerala', 25: 'Fort kochi, Kerala',
  26: 'Kerala', 27: 'Fort kochi, Kerala', 28: 'Kerala', 29: 'Kerala', 30: 'Kerala', 31: 'Kerala', 32: 'Kerala', 33: 'Kerala', 34: 'Kerala',
  35: 'Mangluru', 36: 'Mangluru', 37: 'Mangluru', 38: 'Mangluru', 39: 'Mangluru',
  40: 'Wada, Maharashtra', 41: 'Mumbai, Maharashtra', 42: 'Mangluru', 43: 'Maharashtra',
  44: 'Mangluru', 45: 'Mangluru', 46: 'Mangluru', 47: 'Mangluru',
  48: 'Padubidri beach, Udupi', 49: 'Padubidri beach, Udupi', 50: 'Padubidri beach, Udupi',
  51: 'Marine Drive, Mumbai', 52: 'Padubidri beach, Udupi', 53: 'Padubidri beach, Udupi',
  54: 'Padubidri beach, Udupi', 55: 'Padubidri beach, Udupi', 56: 'Padubidri beach, Udupi',
  57: 'Padubidri beach, Udupi', 58: 'Padubidri beach, Udupi', 59: 'Kerala', 60: 'Kerala',
  61: 'Padubidri beach, Udupi', 62: 'Padubidri beach, Udupi', 63: 'Mumbai, Maharashtra',
  64: 'Mumbai, Maharashtra', 66: 'Pune, Maharashtra', 67: 'Pune, Maharashtra',
  72: 'Marine Drive, Mumbai', 73: 'Marine Drive, Mumbai', 74: 'Marine Drive, Mumbai', 75: 'Marine Drive, Mumbai',
  76: 'Taj hotel, Mumbai', 77: 'Gurudwara Shri Manikaran Sahib, Manikaran', 78: 'Manikaran',
  79: 'Manali', 80: 'Manali', 81: 'Manali', 82: 'Hadimba temple, Manali',
  83: 'Ugrasen ki Baoli, New Delhi', 84: 'Red fort, Delhi', 85: 'Manikaran',
  86: 'Manikaran', 87: 'Manikaran', 88: 'Manali', 89: 'Manali', 90: 'Manali',
  91: 'Manali', 92: 'Manali', 93: 'Mall road, Manali', 94: 'Manali', 95: 'Manali',
  96: 'Attari - Wagah Border, Punjab', 97: 'Attari - Wagah Border, Punjab',
  98: 'Mangluru', 99: 'Mangluru', 100: 'Mangluru', 101: 'Mangluru',
  102: 'Padubidri beach, Udupi', 103: 'Mumbai, Maharashtra', 104: 'Goa',
  105: 'Basilica of bom jesus, Goa', 106: 'Basilica of bom jesus, Goa',
};

const images = await Promise.all(
  Object.entries(photoModules)
    .sort(([a], [b]) => {
      const aNum = parseInt(a.match(/photo(\d+)/)?.[1] || '0');
      const bNum = parseInt(b.match(/photo(\d+)/)?.[1] || '0');
      return aNum - bNum;
    })
    .map(async ([path, module]) => {
      const photoNumber = parseInt(path.match(/photo(\d+)/)?.[1] || '0');
      const imageModule = module as any;
      
      if (!imageModule.default) return null;
      
      const fullSize = await getImage({
        src: imageModule.default,
        width: 1200,
        height: 900,
        format: 'webp',
        quality: 90
      });

      const thumbnail = await getImage({
        src: imageModule.default,
        width: 800,
        height: 600,
        format: 'webp',
        quality: 85
      });

      return {
        src: fullSize.src,
        thumbnail: thumbnail.src,
        alt: 'photography',
        title: photoTitles[photoNumber] || `Photo ${photoNumber}`,
      };
    })
).then(results => results.filter(Boolean));
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Photography</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    {images.slice(0, 3).map(image => (
      <link rel="preload" as="image" href={image.thumbnail} />
    ))}
  </head>
  <body>
    <main class="h-full w-full px-10 overflow-hidden">
      <ImageCarousel 
        images={images}
        client:load
        options={{
          infinite: true,
          slidesPerPage: 1,
          center: true,
          Dots: true,
          Navigation: true,
          Arrows: {
            autoHide: false,
          },
        }}
      />
    </main>
  </body>
</html>
